<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Screen Math Scanner</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 40px; }
    pre { background: #f0f0f0; padding: 15px; border-radius: 10px; white-space: pre-wrap; }
    button { padding: 12px 20px; font-size: 16px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>🧠 Screen Math Scanner</h1>
  <button id="scanBtn">📸 Scan Screen</button>
  <p id="status">Waiting...</p>
  <pre id="result"></pre>

  <video id="video" autoplay style="display:none;"></video>
  <canvas id="canvas" style="display:none;"></canvas>

  <script>
    const scanBtn = document.getElementById('scanBtn');
    const status = document.getElementById('status');
    const result = document.getElementById('result');
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');

    scanBtn.onclick = async () => {
      result.textContent = "";
      status.textContent = "🟡 Requesting screen access...";
      try {
        const stream = await navigator.mediaDevices.getDisplayMedia({ video: true });
        video.srcObject = stream;
        await new Promise(resolve => video.onloadedmetadata = resolve);

        // Capture one frame
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

        // Stop video stream
        stream.getTracks().forEach(track => track.stop());

        status.textContent = "🟡 Scanning for text...";

        const { data } = await Tesseract.recognize(canvas, 'eng');
        const rawText = data.text.trim();
        result.textContent = `📝 Text Detected:\n${rawText}`;

        if (!rawText) {
          result.textContent = "🤷 I couldn't find any text.";
          return;
        }

        // Clean and fix OCR text
        let cleaned = rawText
          .replace(/×|x|X/g, '*')    // Replace x and × with *
          .replace(/÷|:/g, '/')      // Replace ÷ and : with /
          .replace(/[^0-9+\-*/().= ]/g, '') // Remove weird characters

        // Only use what's before the equal sign
        const expression = cleaned.split('=')[0].trim();

        if (/^[0-9+\-*/(). ]+$/.test(expression)) {
          try {
            const answer = eval(expression);
            result.textContent += `\n\n✅ Solved: ${expression} = ${answer}`;
          } catch (e) {
            result.textContent += `\n\n⚠️ I found math but couldn't solve it.`;
          }
        } else {
          result.textContent += `\n\n🤔 Doesn't look like a clean math problem.`;
        }

        status.textContent = "✅ Done!";
      } catch (err) {
        console.error(err);
        status.textContent = "❌ Error: " + err.message;
      }
    };
  </script>
</body>
</html>
