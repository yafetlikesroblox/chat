<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>School GPT App</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    /* Add your previous styles here */
  </style>
</head>
<body>
  <div class="app">
    <img src="https://static.wixstatic.com/media/410c2b_b7dc610babc94c858f50edba050eda87~mv2.png/v1/fill/w_174,h_174,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/School.png" 
         alt="Math Scanner Logo" 
         style="max-width: 100px; margin-bottom: 20px; border-radius: 50%;" />
         
    <h1>School GPT</h1>

    <!-- Math Solver -->
    <button id="scanBtn">Scan Screen</button>
    <input type="text" id="manualInput" placeholder="Type a math expression like 2x2" />
    <button id="solveBtn">Solve</button>

    <!-- Question Input & Mic -->
    <input type="text" id="questionInput" placeholder="Ask any question..." />
    <button onclick="searchQuestion()">Search Answer</button>
    <button onclick="startListening()" class="mic-btn">ğŸ™ï¸ Speak</button>

    <p id="status">Ready to scan or solve.</p>
    <pre id="result">Click a button to get started!</pre>
  </div>

  <video id="video" autoplay></video>
  <canvas id="canvas"></canvas>

  <script>
    const scanBtn = document.getElementById('scanBtn');
    const solveBtn = document.getElementById('solveBtn');
    const manualInput = document.getElementById('manualInput');
    const status = document.getElementById('status');
    const result = document.getElementById('result');
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');

    scanBtn.onclick = async () => {
      result.textContent = "";
      status.textContent = "ğŸŸ¡ Requesting screen access...";
      try {
        const stream = await navigator.mediaDevices.getDisplayMedia({ video: true });
        video.srcObject = stream;
        await new Promise(resolve => video.onloadedmetadata = resolve);

        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

        stream.getTracks().forEach(track => track.stop());
        status.textContent = "ğŸŸ¡ Scanning for text...";

        const { data } = await Tesseract.recognize(canvas, 'eng');
        const rawText = data.text.trim();
        result.textContent = `ğŸ“ Detected:\n${rawText}`;

        if (!rawText) {
          result.textContent = "ğŸ¤· I couldn't find any text.";
          status.textContent = "âš ï¸ No text found.";
          return;
        }

        handleInput(rawText);
      } catch (err) {
        console.error(err);
        status.textContent = "âŒ Error: " + err.message;
        result.textContent = "Something went wrong.";
      }
    };

    solveBtn.onclick = () => {
      const typed = manualInput.value.trim();
      if (!typed) {
        result.textContent = "âš ï¸ Please type something first.";
        return;
      }
      result.textContent = `ğŸ“ You typed:\n${typed}`;
      handleInput(typed);
    };

    function handleInput(input) {
      let cleaned = input
        .replace(/Ã—|x|X/g, '*')
        .replace(/Ã·|:/g, '/')
        .replace(/[^0-9+\-*/().= ]/g, '');

      const expression = cleaned.split('=')[0].trim();

      if (/^[0-9+\-*/(). ]+$/.test(expression)) {
        try {
          const answer = eval(expression);
          result.textContent += `\n\nâœ… Answer: ${expression} = ${answer}`;
          status.textContent = "âœ… Done!";
        } catch (e) {
          result.textContent += `\n\nâš ï¸ I found math but couldnâ€™t solve it.`;
          status.textContent = "âš ï¸ Error solving.";
        }
      } else {
        result.textContent += `\n\nâŒ Not a valid math expression.`;
        status.textContent = "âš ï¸ Unrecognized input.";
      }
    }

    function searchQuestion() {
      const question = document.getElementById("questionInput").value.trim();
      if (!question) {
        result.textContent = "âš ï¸ Please enter a question to search.";
        return;
      }

      // Fallback responses for known questions
      const fallbackResponses = {
        "what is 2x2": "2x2 = 4",
        "who is the president of the United States": "As of 2025, the president is Joe Biden.",
        "how old is mcdonalds": "McDonald's was founded in 1940, making it 85 years old in 2025."
      };

      if (fallbackResponses[question.toLowerCase()]) {
        result.textContent = `âœ… Answer found!\n\nğŸ§  You asked:\n${question}\n\nğŸ§  Answer: ${fallbackResponses[question.toLowerCase()]}`;
        status.textContent = "âœ… Answer provided from predefined list.";
        return;
      }

      const url = `https://duckduckgo.com/?q=${encodeURIComponent(question)}`;
      fetch(url)
        .then(response => response.text())
        .then(data => {
          const parser = new DOMParser();
          const doc = parser.parseFromString(data, 'text/html');
          const answer = doc.querySelector('.result__body');
          if (answer) {
            result.textContent = `âœ… Answer found!\n\nğŸ§  You asked:\n${question}\n\nğŸ” DuckDuckGo says:\n${answer.textContent.trim()}`;
          } else {
            result.textContent = `ğŸ” DuckDuckGo says: No direct answer found.`;
          }
        })
        .catch(error => {
          console.error(error);
          result.textContent = "âš ï¸ Error fetching results.";
        });

      status.textContent = "ğŸ” Searching on DuckDuckGo...";
    }

    function startListening() {
      if (!('webkitSpeechRecognition' in window)) {
        alert("ğŸ¤ Your browser doesn't support speech recognition. Try using Google Chrome.");
        return;
      }

      const recognition = new webkitSpeechRecognition();
      recognition.lang = "en-US";
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      status.textContent = "ğŸ¤ Listening...";
      recognition.start();

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        document.getElementById("questionInput").value = transcript;
        result.textContent = `ğŸ—£ï¸ Heard: "${transcript}"`;
        status.textContent = "âœ… Voice captured. Click 'Search Answer'!";
      };

      recognition.onerror = (event) => {
        status.textContent = "âŒ Voice error: " + event.error;
        result.textContent = "âš ï¸ Couldn't hear anything useful.";
      };

      recognition.onend = () => {
        status.textContent += " (Stopped listening)";
      };
    }
  </script>
</body>
</html>

