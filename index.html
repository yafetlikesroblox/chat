<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>School GPT</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: #f2f4f8;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .app {
      background: white;
      border-radius: 20px;
      padding: 30px 40px;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
      text-align: center;
      transition: all 0.3s ease;
    }

    h1 {
      font-size: 28px;
      margin-bottom: 20px;
      color: #222;
    }

    button {
      padding: 12px 24px;
      font-size: 16px;
      font-weight: 600;
      color: white;
      background: #4f46e5;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.2s ease;
      margin-top: 10px;
    }

    button:hover {
      background: #3730a3;
    }

    input {
      margin-top: 15px;
      padding: 10px;
      width: 100%;
      font-size: 15px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    #status {
      margin-top: 20px;
      font-size: 15px;
      color: #555;
    }

    #result {
      margin-top: 20px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      padding: 15px;
      border-radius: 10px;
      text-align: left;
      white-space: pre-wrap;
      color: #333;
      font-size: 14px;
    }

    @media (max-width: 600px) {
      .app {
        padding: 20px;
      }

      h1 {
        font-size: 22px;
      }

      button {
        width: 100%;
      }
    }

    video, canvas {
      display: none;
    }

    .mic-btn {
      background-color: #10b981;
    }

    .mic-btn:hover {
      background-color: #059669;
    }
  </style>
</head>
<body>
  <div class="app">
    <img src="https://static.wixstatic.com/media/410c2b_b7dc610babc94c858f50edba050eda87~mv2.png/v1/fill/w_174,h_174,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/School.png" 
         alt="Math Scanner Logo" 
         style="max-width: 100px; margin-bottom: 20px; border-radius: 50%;" />

    <h1>School GPT</h1>

    <button id="scanBtn">Scan Screen</button>
    <input type="text" id="manualInput" placeholder="Type a math expression like 2x2" />
    <button id="solveBtn">Solve</button>

    <input type="text" id="questionInput" placeholder="Ask any question..." />
    <button onclick="searchQuestion()">Search Answer</button>
    <button onclick="startListening()" class="mic-btn">üéôÔ∏è Speak</button>

    <p id="status">Ready to scan or solve.</p>
    <pre id="result">Tell The AI your question NOTE (Do not put a equation!)</pre>
  </div>

  <video id="video" autoplay></video>
  <canvas id="canvas"></canvas>

  <script>
    const scanBtn = document.getElementById('scanBtn');
    const solveBtn = document.getElementById('solveBtn');
    const manualInput = document.getElementById('manualInput');
    const status = document.getElementById('status');
    const result = document.getElementById('result');
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');

    const answerCache = JSON.parse(localStorage.getItem('answerCache') || '{}');

    scanBtn.onclick = async () => {
      result.textContent = "";
      status.textContent = "üü° Requesting screen access...";
      try {
        const stream = await navigator.mediaDevices.getDisplayMedia({ video: true });
        video.srcObject = stream;
        await new Promise(resolve => video.onloadedmetadata = resolve);

        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

        stream.getTracks().forEach(track => track.stop());
        status.textContent = "üü° Scanning for text...";

        const { data } = await Tesseract.recognize(canvas, 'eng');
        const rawText = data.text.trim();
        result.textContent = `üìù Detected:\n${rawText}`;

        if (!rawText) {
          result.textContent = "ü§∑ I couldn't find any text.";
          status.textContent = "‚ö†Ô∏è No text found.";
          return;
        }

        handleInput(rawText);
      } catch (err) {
        console.error(err);
        status.textContent = "‚ùå Error: " + err.message;
        result.textContent = "Something went wrong.";
      }
    };

    solveBtn.onclick = () => {
      const typed = manualInput.value.trim();
      if (!typed) {
        result.textContent = "‚ö†Ô∏è Please type something first.";
        return;
      }
      result.textContent = `üìù You typed:\n${typed}`;
      handleInput(typed);
    };

    function handleInput(input) {
      let cleaned = input
        .replace(/√ó|x|X/g, '*')
        .replace(/√∑|:/g, '/')
        .replace(/[^0-9+\-*/().= ]/g, '');

      const expression = cleaned.split('=')[0].trim();

      if (/^[0-9+\-*/(). ]+$/.test(expression)) {
        try {
          const answer = eval(expression);
          result.textContent += `\n\n‚úÖ Answer: ${expression} = ${answer}`;
          status.textContent = "‚úÖ Done!";
          return;
        } catch (e) {
          result.textContent += `\n\n‚ö†Ô∏è I found math but couldn‚Äôt solve it.`;
          status.textContent = "‚ö†Ô∏è Error solving.";
          return;
        }
      }

      result.textContent += `\n\n‚ùå Not a valid math expression.`;
      status.textContent = "‚ö†Ô∏è Unrecognized input.";
    }

    function extractAnswer(parsed) {
      if (parsed.Answer) return parsed.Answer;
      if (parsed.Abstract) return parsed.Abstract;
      const topics = parsed.RelatedTopics || [];
      for (let t of topics) {
        if (t.Text) return t.Text;
        if (t.Topics && t.Topics.length && t.Topics[0].Text) return t.Topics[0].Text;
      }
      return null;
    }

    async function searchQuestion() {
      const question = document.getElementById("questionInput").value.trim();
      if (!question) {
        result.textContent = "‚ö†Ô∏è Please enter a question to search.";
        return;
      }

      result.textContent = `üß† You asked:\n${question}`;

      const lowerQ = question.toLowerCase();
      if (answerCache[lowerQ]) {
        result.textContent += `\n\nüß† Cached Answer:\n${answerCache[lowerQ]}`;
        status.textContent = "‚ö° From memory!";
        return;
      }

      // special easter egg
      if (lowerQ.includes("how old is schoolgpt")) {
        const response = "SchoolGPT was made in April 2025 by https://github.com/yafetlikesroblox ‚Äî and it's still kinda dumb but learning!";
        answerCache[lowerQ] = response;
        localStorage.setItem('answerCache', JSON.stringify(answerCache));
        result.textContent += `\n\nü§ñ ${response}`;
        status.textContent = "üí° Answered!";
        return;
      }

      const mathLike = /^[0-9 x√ó√∑*+/=().?-]+$/i.test(question);
      if (mathLike) {
        result.textContent += `\n\nüí° That looks like math ‚Äî try the Solve button instead.`;
        status.textContent = "ü§î Math-like question detected.";
        return;
      }

      status.textContent = "üîç Searching Wikipedia...";
      try {
        const res = await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(question)}`);
        const data = await res.json();
        if (data.extract) {
          answerCache[lowerQ] = data.extract;
          localStorage.setItem('answerCache', JSON.stringify(answerCache));
          result.textContent += `\n\nüåê Wikipedia says:\n${data.extract}`;
          status.textContent = "‚úÖ Found on Wikipedia!";
          return;
        }
      } catch (e) {}

      status.textContent = "üîç Searching DuckDuckGo...";
      try {
        const res = await fetch(`https://api.duckduckgo.com/?q=${encodeURIComponent(question)}&format=json&no_redirect=1&no_html=1`);
        const parsed = await res.json();
        let answer = extractAnswer(parsed);
        if (answer) {
          answerCache[lowerQ] = answer;
          localStorage.setItem('answerCache', JSON.stringify(answerCache));
          result.textContent += `\n\nüîç DuckDuckGo says:\n${answer}`;
          status.textContent = "‚úÖ Answer found!";
        } else {
          result.textContent += "\n\n‚ö†Ô∏è Couldn't find a direct answer.";
          status.textContent = "‚ùì No direct answer.";
        }
      } catch (err) {
        result.textContent += "\n\n‚ùå Error fetching results.";
        status.textContent = "‚ùå Error: " + err.message;
      }
    }

    function startListening() {
      if (!('webkitSpeechRecognition' in window)) {
        alert("üé§ Your browser doesn't support speech recognition. Try using Google Chrome.");
        return;
      }

      const recognition = new webkitSpeechRecognition();
      recognition.lang = "en-US";
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      status.textContent = "üé§ Listening...";
      recognition.start();

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        document.getElementById("questionInput").value = transcript;
        result.textContent = `üó£Ô∏è Heard: "${transcript}"`;
        status.textContent = "‚úÖ Voice captured. Click 'Search Answer'!";
      };

      recognition.onerror = (event) => {
        status.textContent = "‚ùå Voice error: " + event.error;
        result.textContent = "‚ö†Ô∏è Couldn't hear anything useful.";
      };

      recognition.onend = () => {
        status.textContent += " (Stopped listening)";
      };
    }
  </script>
</body>
</html>

